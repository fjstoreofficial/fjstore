<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>FJ.Store – Produk</title>
<style>
/* ===== STYLE ===== */
body{
  font-family: Arial, sans-serif; margin:0; padding:0;
  background:url("latarbelakang.jpg") center/cover no-repeat fixed;
  position: relative;
}
body::before{
  content:""; position:fixed; inset:0; backdrop-filter: blur(9px); background: rgba(0,0,0,0.45); z-index: -1;
}
header{
  background: rgba(0,0,0,0.65); color:white; font-size:24px; font-weight:bold;
  padding:20px; text-align:center; position: relative; border-bottom:1px solid rgba(255,255,255,0.2);
}
#wishlistIcon{
  position:absolute; right:20px; top:50%; transform:translateY(-50%);
  font-size:22px; cursor:pointer; opacity:.9; transition:.25s;
}
#wishlistIcon:hover{
  transform:translateY(-50%) scale(1.15); text-shadow:0 0 15px #ff4d6d; opacity:1;
}
.products-container{
  padding:20px; display:grid; gap:20px;
  grid-template-columns: repeat(auto-fill,minmax(220px,1fr)); max-width:1200px; margin:auto;
}
.product-card{
  background:rgba(255,255,255,0.15); backdrop-filter: blur(7px); border-radius:14px;
  padding:15px; text-align:center; color:white; text-decoration:none; box-shadow:0 4px 20px rgba(0,0,0,0.25);
  border:1px solid rgba(255,255,255,0.25); position:relative; overflow:hidden;
  transition:.3s;
}
.product-card:hover{
  transform: scale(1.05); background:rgba(255,255,255,0.26); box-shadow:0 6px 30px rgba(0,0,0,0.35);
}
.product-card img{ width:100%; height:220px; object-fit:cover; border-radius:10px; margin-bottom:12px; }
.product-name{ font-size:18px; font-weight:bold; text-shadow:1px 1px 3px #000; margin-bottom:5px; }
.product-price{ font-size:16px; color:#ffeb3b; font-weight:bold; text-shadow:1px 1px 3px #000; margin-bottom:5px; }
.wishlist-heart{
  position:absolute; top:12px; right:12px; font-size:22px; cursor:pointer;
  transition: transform .25s, color .25s; text-shadow:1px 1px 4px black; opacity:.85; z-index:99;
}
.wishlist-heart:hover{ transform: scale(1.15); opacity:1; }
.wishlist-heart.active{ color:#ff4d6d; transform: scale(1.25); animation:bounce .3s; }
@keyframes bounce{ 0%{transform:scale(1);} 50%{transform:scale(1.4);} 100%{transform:scale(1.25);} }
.particle{ position:absolute; width:6px; height:6px; background:#ff4d6d; border-radius:50%; pointer-events:none; animation:particleMove 0.8s forwards; z-index:100; }
@keyframes particleMove{ 0%{ transform:translate(0,0) scale(1); opacity:1; } 100%{ transform:translate(var(--x),var(--y)) scale(0); opacity:0; } }
</style>
</head>
<body>

<header>
  Produk FJ.Store
  <span id="wishlistIcon">❤️ <span id="wishlistCount">(0)</span></span>
</header>

<div class="products-container" id="products"></div>

<script>
/* ===== Wishlist Utilities ===== */
function getWishlist(){ return JSON.parse(localStorage.getItem("wishlist"))||[]; }
function saveWishlist(list){ localStorage.setItem("wishlist",JSON.stringify(list)); }
function updateWishlistCounter(){ document.getElementById("wishlistCount").innerText=`(${getWishlist().length})`; }
updateWishlistCounter();

function animateHeart(x,y){
  const el=document.createElement("div"); el.className="fly-heart"; el.innerText="❤️";
  el.style.left=x+"px"; el.style.top=y+"px"; document.body.appendChild(el);
  setTimeout(()=>el.remove(),900);
}
function spawnParticles(x,y){
  for(let i=0;i<8;i++){
    const p=document.createElement("div"); p.className="particle";
    const angle=Math.random()*2*Math.PI; const radius=30+Math.random()*20;
    p.style.left=`${x}px`; p.style.top=`${y}px`;
    p.style.setProperty("--x",`${Math.cos(angle)*radius}px`);
    p.style.setProperty("--y",`${Math.sin(angle)*radius}px`);
    document.body.appendChild(p);
    setTimeout(()=>p.remove(),800);
  }
}

/* ===== Load Products ===== */
async function loadProducts(){
  const container=document.getElementById("products");
  let data=[];
  try{ const res=await fetch("products.json"); data=await res.json(); }catch(e){ console.error(e); return; }
  container.innerHTML="";
  data.forEach(p=>{
    const card=document.createElement("a");
    card.className="product-card"; card.href=`detail.html?id=${p.id}`;
    card.innerHTML=`
      <img src="${p.image}" alt="${p.name}">
      <div class="product-name">${p.name}</div>
      <div class="product-price">Rp ${Number(p.price).toLocaleString("id-ID")}</div>
    `;
    // Heart
    const heart=document.createElement("div"); heart.className="wishlist-heart"; heart.innerText="❤";
    if(getWishlist().includes(p.id)) heart.classList.add("active");
    heart.onclick=e=>{
      e.preventDefault(); e.stopPropagation();
      const rect=heart.getBoundingClientRect();
      const cx=Math.round(rect.left+rect.width/2); const cy=Math.round(rect.top+rect.height/2);
      let wish=getWishlist();
      if(wish.includes(p.id)){
        wish=wish.filter(x=>x!==p.id); heart.classList.remove("active");
      } else {
        wish.push(p.id); heart.classList.add("active"); animateHeart(cx,cy); spawnParticles(cx,cy);
      }
      saveWishlist(wish); updateWishlistCounter(); window.dispatchEvent(new Event("wishlistUpdated"));
    };
    card.appendChild(heart);
    container.appendChild(card);
  });
}

/* ===== Wishlist Header Click ===== */
document.getElementById("wishlistIcon").onclick=()=>{ window.location.href="wishlist.html"; };

/* ===== Patch: ensure wishlist IDs are numbers ===== */
(function patchWishlist(){ 
  let list=getWishlist().map(x=>Number(x)).filter(x=>x>0); 
  saveWishlist(list); updateWishlistCounter();
})();

/* ===== Auto Load ===== */
loadProducts();
window.addEventListener("storage",e=>{ if(e.key==="wishlist") loadProducts(); });
window.addEventListener("wishlistUpdated",()=>loadProducts());
</script>

</body>
</html>
